<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Blues Yu">





<title>ğŸ è®©ä½ çš„ Python é™æ€èµ·æ¥ | å¸ƒé²æ–¯é±¼çš„å¦™æƒ³å¤©å¼€</title>



    <link rel="icon" href="/favicon.svg">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">å¸ƒé²æ–¯é±¼çš„å¦™æƒ³å¤©å¼€</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">æŠ€æœ¯</a>
                
                    <a class="menu-item" href="/category">ç”Ÿæ´»</a>
                
                    <a class="menu-item" href="/tag">æ ‡ç­¾</a>
                
                    <a class="menu-item" href="/about">å…³äºæˆ‘</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">å¸ƒé²æ–¯é±¼çš„å¦™æƒ³å¤©å¼€</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">æŠ€æœ¯</a>
                
                    <a class="menu-item" href="/category">ç”Ÿæ´»</a>
                
                    <a class="menu-item" href="/tag">æ ‡ç­¾</a>
                
                    <a class="menu-item" href="/about">å…³äºæˆ‘</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">ğŸ è®©ä½ çš„ Python é™æ€èµ·æ¥</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Blues Yu</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">April 1, 2019&nbsp;&nbsp;19:58:42</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="ä¸ºä»€ä¹ˆè¦-â€œé™æ€â€ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦-â€œé™æ€â€ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ â€œé™æ€â€ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ â€œé™æ€â€ï¼Ÿ</h2><p>åœ¨ä¸€åˆ‡å¼€å§‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸ªå°ä¾‹å­:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_weapons_status</span>():</span><br><span class="line">	weapon_status = &#123;</span><br><span class="line">		<span class="string">&quot;LeviathanAxe&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">		<span class="string">&quot;BladesofChaos&quot;</span>: <span class="literal">False</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> weapon_status,</span><br><span class="line"></span><br><span class="line">weapons_status = get_weapons_status()</span><br><span class="line"><span class="keyword">for</span> weapon, status <span class="keyword">in</span> weapons_status.items():</span><br><span class="line">	<span class="keyword">if</span> status:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;weapon&#125;</span> is ready&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬çš„é¢„æƒ³é‡Œï¼Œä¸Šè¿°ä»£ç åº”è¯¥ä¼šè¾“å‡º <code>LeviathanAxe is ready</code>ï¼Œä½†å®é™…è¿è¡Œåˆ™ä¼šæŠ¥é”™ï¼š<code>AttributeError: &#39;tuple&#39; object has no attribute &#39;items&#39;</code></p>
<p>çœ¼å°–çš„åŒå­¦è‚¯å®šå‘ç°äº†ï¼Œè¿™æ®µä»£ç çš„é—®é¢˜æ˜¯åœ¨ <code>get_weapons_status</code>çš„<code>return</code> è¯­å¥åå¤šåŠ äº†ä¸€ä¸ª <code>,</code>ï¼Œæ‰€ä»¥å‡½æ•°çš„è¿”å›å€¼å¹¶ä¸æ˜¯é¢„æœŸçš„ <code>dict</code> ç±»å‹ï¼Œè€Œæ˜¯ <code>tuple</code>ã€‚ç„¶è€Œå¯¹äºè¿™æ ·çš„å†™æ³•ï¼ŒIDE å¯èƒ½ä¸ä¼šæœ‰æ˜æ˜¾æç¤ºï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬åš<strong>å¤§æ®µçš„</strong>ä»£ç é‡æ„æˆ–è¿ç§»æ—¶ï¼Œå®ƒä»¬å¾ˆå®¹æ˜“è¢«å¿½ç•¥ï¼Œç›´åˆ°è¿è¡Œæ—¶æ‰ä¼šå†’å‡ºæ¥ã€‚</p>
<p>æˆ‘ä»¬å¸¸æŠŠè¿™ç±»é—®é¢˜å½’ç»“äºè‡ªå·±çš„ç²—å¿ƒå¤§æ„ï¼Œä½†æ˜¯æ²¡æœ‰æƒ³è¿‡å®ƒä»¬çš„â€œåŸç½ªâ€å…¶å®åº”è¯¥æ˜¯ <strong>Python çš„åŠ¨æ€</strong>ã€‚</p>
<p>è¯šç„¶ï¼ŒPython çš„åŠ¨æ€ç»™æˆ‘ä»¬å¸¦æ¥äº†è¯¸å¤šé…·ç‚«çš„ç‰¹æ€§ï¼š<code>monkey_patch</code>ã€å„ç§é­”æ³•æ–¹æ³•ã€æä¸ºæ–¹ä¾¿çš„ mock æµ‹è¯•â€¦..ä½†åœ¨é€»è¾‘åˆ†å±‚è®¾è®¡ã€å‚æ•°æ ¡éªŒã€ä»£ç è¡¥å…¨æ—¶æˆ‘ä»¬åˆæ— æ¯”æ¸´æœ›ä¸€äº› â€œé™æ€â€ ç‰¹æ€§ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœ Python èƒ½å¤Ÿ â€œé™æ€â€ ä¸€äº›ï¼Œå°†ä¼šç»™æˆ‘ä»¬å¸¦æ¥å‡ ä¸ªæ˜æ˜¾çš„å¢ç›Šï¼š</p>
<ul>
<li>å¤§å¹…åº¦æå‡ä»£ç çš„å¯è¯»æ€§</li>
<li>èƒ½å¤Ÿå°†å‚æ•°ä¼ é€’æ—¶çš„ <code>ç±»å‹é”™è¯¯</code> æ‰¼æ€åœ¨æ‘‡(biÄn)ç¯®(mÇ)ä¸­</li>
<li>èƒ½å¤Ÿæœ€å¤§ç¨‹åº¦åˆ©ç”¨ IDE æä¾›çš„ä»£ç æç¤ºï¼Œå‡å°‘ <code>typo</code></li>
</ul>
<p>é‚£ä¹ˆè¯¥å¦‚ä½•æ‹¥æœ‰è¿™äº›â€œé™æ€â€çš„ç‰¹æ€§å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°†æ—¶é—´ç•™ç»™æœ¬æ–‡çš„ä¸»è§’â€”â€”<code>typing annotaion</code>ã€‚</p>
<h2 id="Typing-Annotation"><a href="#Typing-Annotation" class="headerlink" title="Typing Annotation"></a>Typing Annotation</h2><p>ä» Python 3.5 å¼€å§‹ï¼Œ <code>type annotation</code> å·²ç»æ­£å¼è¢«å¼•å…¥äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å¯¹ä»»ä½•å˜é‡è¿›è¡Œç±»å‹æ³¨è§£ï¼Œæ— è®ºæ˜¯<strong>èµ‹å€¼ä¹‹å‰</strong>è¿˜æ˜¯<strong>å‡½æ•°ä¼ å‚å’Œè¿”å›</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æˆ‘ä»¬å¯ä»¥ä»ç±»ã€æ¨¡å—ã€å‡½æ•°çš„ `__annotations__` å˜é‡ä¸­è·å–è¿™äº›æ³¨è§£</span></span><br><span class="line">nine_realms: <span class="type">List</span>[<span class="built_in">str</span>] = [<span class="string">&quot;Niflheim&quot;</span>, <span class="string">&quot;Muspelheim&quot;</span>, <span class="string">&quot;Asgard&quot;</span>, <span class="string">&quot;Midgard&quot;</span>, <span class="string">&quot;Jotunheim&quot;</span>, <span class="string">&quot;Vanaheim&quot;</span>, <span class="string">&quot;Alfheim&quot;</span>, <span class="string">&quot;Svartalfheim&quot;</span>, <span class="string">&quot;Helheim&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Yggdrasill</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">transport</span>(<span class="params">realm: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ç±»å‹æ³¨é‡Šï¼Ÿ"><a href="#ç±»å‹æ³¨é‡Šï¼Ÿ" class="headerlink" title="ç±»å‹æ³¨é‡Šï¼Ÿ"></a>ç±»å‹æ³¨é‡Šï¼Ÿ</h3><p>é™¤äº†â€œæ³¨è§£â€ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»å‹æ³¨é‡Š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pi = <span class="number">3.142</span> <span class="comment"># type: <span class="built_in">float</span></span></span><br></pre></td></tr></table></figure>

<p>ç›¸è¾ƒäºâ€œæ³¨è§£â€ï¼Œæ³¨é‡Šå¯¹ä»£ç çš„ä¾µå…¥æ€§æ›´å°ï¼Œä½†åŒæ—¶å¯è¯»æ€§æ›´å·®ï¼Œåªé€‚ç”¨äºä¸æ”¯æŒæ³¨è§£çš„åœºæ™¯ã€‚å®˜æ–¹æ¨èä½¿ç”¨ç±»å‹æ³¨è§£ï¼Œæ‰€ä»¥ç±»å‹æ³¨é‡Šçš„å†…å®¹å°±ä¸å†å±•å¼€äº†ã€‚</p>
<h3 id="Gradual-typing"><a href="#Gradual-typing" class="headerlink" title="Gradual typing"></a>Gradual typing</h3><p>ç±»å‹æ³¨è§£åªä¼šç”Ÿå­˜äºâ€œç¼–ç æ—¶â€ï¼Œå¹¶ä¸å½±å“è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒå¤§èƒ†åœ°ä¸ºæ—§ä»£ç æ·»åŠ æ³¨è§£ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå¯¹å®é™…åŠŸèƒ½äº§ç”Ÿå½±å“ã€‚å½“ç„¶å¯¹äºå¤§å‹é¡¹ç›®ï¼ˆåªè¦æ³¨è§£æœ¬èº«ä¸å†™é”™ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–â€œæ¸è¿›å¼æ³¨è§£â€ï¼Œå¯¹ä¸€äº›å…³é”®çš„æ ¸å¿ƒæ¨¡å—å…ˆè¿›è¡Œæ”¹é€ ï¼Œè¯¦è§ <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0483/#summary-of-gradual-typing">gradual typing</a></p>
<h3 id="Types-å’Œ-Classes"><a href="#Types-å’Œ-Classes" class="headerlink" title="Types å’Œ Classes"></a>Types å’Œ Classes</h3><p>éœ€è¦é¢å¤–è¯´æ˜çš„æ˜¯ï¼Œåœ¨ç±»å‹æ³¨è§£ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨ â€œç±»(class)â€ å’Œ â€œç±»å‹(type)â€ åšæ³¨è§£ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name: <span class="built_in">str</span> = <span class="string">&quot;Atreus&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line">names: <span class="type">List</span>[<span class="built_in">str</span>] = [<span class="string">&quot;Atreus&quot;</span>, <span class="string">&quot;Loki&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>str</code> æ—¢æ˜¯ä¸€ç§ â€œç±»â€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§ â€œç±»å‹â€ï¼Œè€Œ <code>List</code> åªæ˜¯ä¸€ç§ â€œç±»å‹â€ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½å¤Ÿåœ¨ â€œè¿è¡Œæ—¶â€ ä½¿ç”¨å®ƒä»¬çš„ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Names</span>(<span class="type">List</span>[<span class="built_in">str</span>]): ... <span class="comment"># raises TypeError</span></span><br></pre></td></tr></table></figure>

<p>ç®€å•æ¥è¯´ï¼Œä»»ä½•ä¸€ç§ â€œç±»â€ éƒ½å¯ä»¥è¢«å½“ä½œä¸€ç§ â€ç±»å‹â€œï¼Œåè¿‡æ¥ â€ç±»å‹â€ å´ä¸ä¸€å®šèƒ½è¢«å½“ä½œ â€œç±»â€ ä½¿ç”¨ã€‚</p>
<h2 id="å„ç§ä½¿ç”¨åœºæ™¯"><a href="#å„ç§ä½¿ç”¨åœºæ™¯" class="headerlink" title="å„ç§ä½¿ç”¨åœºæ™¯"></a>å„ç§ä½¿ç”¨åœºæ™¯</h2><p>ä¸‹é¢æˆ‘ä»¬ä¸»è¦å°†å¸¸ç”¨çš„ç±»å‹æ³¨è§£ç»“åˆå·¥ç¨‹åœºæ™¯ä¸¾ä¾‹</p>
<h3 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a>åŸºæœ¬ç±»å‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hey_boy</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;Boy: &#x27;</span> + name</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä¸Šé¢æåˆ°ï¼Œä»»ä½•åŸºæœ¬ç±»å‹éƒ½å¯ä»¥ç›´æ¥å½“åšæ³¨è§£ä½¿ç”¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š<code>int</code>ã€<code>str</code>ã€<code>list</code>ã€<code>dict</code>ã€<code>set</code>ã€<code>None</code>ã€<code>bool</code>ã€<code>tuple</code>ç­‰ç­‰ï¼Œ</p>
<h3 id="å®¹å™¨ç±»å‹"><a href="#å®¹å™¨ç±»å‹" class="headerlink" title="å®¹å™¨ç±»å‹"></a>å®¹å™¨ç±»å‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çº¯å®¹å™¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_names</span>(<span class="params">names: <span class="type">List</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¹å™¨ &amp; å®¹å™¨å†…å…ƒç´ </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_names</span>(<span class="params">names: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print_names([<span class="string">&#x27;Kratos&#x27;</span>, <span class="string">&#x27;Thor&#x27;</span>])</span><br><span class="line">print_names([<span class="string">&#x27;any_type&#x27;</span>, <span class="number">128</span>, &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>&#125;, (<span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>)]) <span class="comment"># ä¸è¢«å…è®¸ï¼Œå®¹å™¨å†…å…ƒç´ ç±»å‹ä¸ä¸€è‡´</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_names</span>(<span class="params">names: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print_names(&#123;<span class="string">&#x27;Blues&#x27;</span>: <span class="string">&#x27;Yu&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="ç±»å‹åˆ«å"><a href="#ç±»å‹åˆ«å" class="headerlink" title="ç±»å‹åˆ«å"></a>ç±»å‹åˆ«å</h3><p>å®¹å™¨å†…å…ƒç´ ä¼šéå¸¸å¤æ‚ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰ç±»ä¼¼ <code>Dict[str, Dict[str: SomeObject]]</code> è¿™ç§ä¸å®¹æ˜“é˜…è¯»çš„å†™æ³•ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<code>ç±»å‹åˆ«å</code>æ¥ç®€åŒ–ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span></span><br><span class="line"></span><br><span class="line">Point = <span class="type">Dict</span>[<span class="built_in">str</span>: SomeObject]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_points</span>(<span class="params">points: <span class="type">Dict</span>[Point]</span>):</span><br><span class="line">	<span class="keyword">for</span> point <span class="keyword">in</span> points:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;X:&quot;</span>, point[<span class="number">0</span>], <span class="string">&quot; Y:&quot;</span>, point[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°ç±»å‹"><a href="#å‡½æ•°ç±»å‹" class="headerlink" title="å‡½æ•°ç±»å‹"></a>å‡½æ•°ç±»å‹</h3><p>åœ¨ç±»ä¼¼è£…é¥°å™¨ã€å›è°ƒç­‰åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å‡½æ•°å‚æ•°ä½œæ³¨è§£ï¼ŒåŸºæœ¬çš„æ ¼å¼ä¸ºï¼š<code>Callable[[Arg1Type, Arg2Type], ReturnType]</code>ã€‚å…¶ä¸­ <code>[Arg1Type, Arg2Type]</code> æ˜¯è¾“å…¥å‚æ•°åˆ—è¡¨ï¼Œ<code>ReturnType</code> æ˜¯è¿”å›å†…å®¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">func: <span class="type">Callable</span>[[<span class="built_in">int</span>], <span class="built_in">str</span>], argument: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">	<span class="built_in">print</span>(func(argument))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bar</span>(<span class="params">name: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">	<span class="keyword">return</span> <span class="string">f&quot;Hello <span class="subst">&#123;name&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">foo(create_greeting, <span class="string">&quot;Jekyll&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="â€œæ³›â€-å‹"><a href="#â€œæ³›â€-å‹" class="headerlink" title="â€œæ³›â€ å‹"></a>â€œæ³›â€ å‹</h3><h3 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬å¯¹äºæŸäº›â€œæ³›â€å‹å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>Any</code> æ¥è¡¨æ˜</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar, AnyStr, <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»»æ„ç±»å‹</span></span><br><span class="line"><span class="comment"># Any å…¼å®¹ä»»æ„ç±»å‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">concat</span>(<span class="params">a: <span class="type">Any</span>, b: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h3 id="TypeVar"><a href="#TypeVar" class="headerlink" title="TypeVar"></a>TypeVar</h3><p><code>TypeVar</code> è¡¨ç¤º <code>Type</code> ç±»å‹ã€‚ç®€å•æ¥è¯´ï¼Œå¥¹å°±æ˜¯â€œç±»å‹â€çš„â€œç±»å‹â€ã€‚å’Œ <code>type</code> å¯ä»¥åˆ›é€  â€œç±»â€ ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>TypeVar</code> æ¥åˆ›é€  â€œç±»å‹â€ã€‚</p>
<p>ä¾‹å¦‚ <code>typing</code> ä¸­æä¾›çš„ <code>AnyStr</code> å…¶å®å°±æ˜¯é€šè¿‡ <code>TypeVar(&#39;AnyStr&#39;, Text, bytes)</code> æ¥è¡¨ç¤ºçš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»»æ„å­—ç¬¦å‹</span></span><br><span class="line"><span class="comment"># AnyStr = TypeVar(&#x27;AnyStr&#x27;, Text, bytes)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">concat</span>(<span class="params">a: AnyStr, b: AnyStr</span>) -&gt; AnyStr:</span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line">concat(<span class="string">u&quot;foo&quot;</span>, <span class="string">u&quot;bar&quot;</span>) </span><br><span class="line">concat(<span class="string">b&quot;foo&quot;</span>, <span class="string">b&quot;bar&quot;</span>) </span><br><span class="line">concat(<span class="string">u&quot;foo&quot;</span>, <span class="string">b&quot;bar&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸Šä¸‰ç§å†™æ³•éƒ½ä¼šè¢«ç±»å‹æ£€æŸ¥æ¥å—ï¼Œä½†æ˜¯è¿è¡Œæ—¶ï¼Œæœ€åä¸€ç§è°ƒç”¨ä¼šæŠ¥é”™ `TypeError: can&#x27;t concat str to bytes`</span></span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°çš„â€œæ³›â€å‹"><a href="#å‡½æ•°çš„â€œæ³›â€å‹" class="headerlink" title="å‡½æ•°çš„â€œæ³›â€å‹"></a>å‡½æ•°çš„â€œæ³›â€å‹</h3><p>æœ‰æ—¶å€™ï¼Œå‡½æ•°å¯èƒ½éœ€è¦æ”¯æŒå¤šç§ç±»å‹è¾“å…¥è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šç§æ–¹æ³•æ¥å®ç°æ³¨è§£ã€‚</p>
<p>ä½¿ç”¨ <code>typing.overload</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> overload, <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@overload</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">switch_names</span>(<span class="params">developers: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@overload</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">switch_names</span>(<span class="params">developers: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œä¸èƒ½æœ‰ç±»å‹æ³¨è§£ï¼Œå¹¶ä¸”éœ€è¦å®ç°ä¸€ä¸ªé€šç”¨çš„åšæ³•</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">switch_names</span>(<span class="params">developers</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">isinstance</span>(developers, <span class="built_in">str</span>):</span><br><span class="line">		<span class="comment"># ä¾‹å¦‚ &quot;ponyma,jackma,allenzhang&quot;</span></span><br><span class="line">		developers = developers.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> developers</span><br><span class="line">	<span class="keyword">elif</span> <span class="built_in">isinstance</span>(developers, <span class="type">List</span>):</span><br><span class="line">		<span class="comment"># ä¾‹å¦‚ [&quot;ponyma&quot;, &quot;jackma&quot;, &quot;allenzhang&quot;]</span></span><br><span class="line">		developers = <span class="string">&#x27;,&#x27;</span>.join(developers)</span><br><span class="line">		<span class="keyword">return</span> developers</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>Union[Type1, Type2]</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Union[X, Y] æ„å‘³ç€æ˜¯ X æˆ– Y ç±»å‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">switch_names</span>(<span class="params">name: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="type">List</span>]</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">isinstance</span>(developers, <span class="built_in">str</span>):</span><br><span class="line">		<span class="comment"># ä¾‹å¦‚ &quot;ponyma,jackma,allenzhang&quot;</span></span><br><span class="line">		developers = developers.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> developers</span><br><span class="line">	<span class="keyword">elif</span> <span class="built_in">isinstance</span>(developers, <span class="type">List</span>):</span><br><span class="line">		<span class="comment"># ä¾‹å¦‚ [&quot;ponyma&quot;, &quot;jackma&quot;, &quot;allenzhang&quot;]</span></span><br><span class="line">		developers = <span class="string">&#x27;,&#x27;</span>.join(developers)</span><br><span class="line">		<span class="keyword">return</span> developers</span><br></pre></td></tr></table></figure>

<h3 id="Union-å’Œ-Optional"><a href="#Union-å’Œ-Optional" class="headerlink" title="Union å’Œ Optional"></a>Union å’Œ Optional</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šå¸¸çš„ Union ç”¨æ³•</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_grade</span>(<span class="params">grade: <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>]</span>):</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">isinstance</span>(grade, <span class="built_in">str</span>):</span><br><span class="line">		<span class="built_in">print</span>(grade + <span class="string">&#x27; percent&#x27;</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">str</span>(grade) + <span class="string">&#x27; percent&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional[X] ç›¸å½“äº Union[X, None]</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">optional_info: <span class="type">Optional</span>[<span class="type">Dict</span>] = <span class="literal">None</span></span>):</span><br><span class="line">	<span class="keyword">return</span> optional_info <span class="keyword">or</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Django-model"><a href="#Django-model" class="headerlink" title="Django model"></a>Django model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span>, <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> QuerySet</span><br><span class="line"><span class="keyword">from</span> my_app.models <span class="keyword">import</span> MyModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨åç»­ä»£ç ä¸­ï¼Œrecords çš„ç±»å‹å°†è¢«ç­‰åŒäº MyModel çš„ QuerySet</span></span><br><span class="line"><span class="comment"># ä¸è¿‡åŒæ—¶éœ€è¦æ³¨æ„ï¼Œå¦‚æœæ­¤æ—¶ä¼ å…¥ä¸€ä¸ªå•çº¯çš„ List[MyModel]ï¼Œ</span></span><br><span class="line"><span class="comment"># å¹¶è°ƒç”¨ QuerySet çš„æ–¹æ³•ï¼Œé™æ€æ£€æŸ¥æ˜¯ä¸ä¼šæ¢æµ‹å‡ºé—®é¢˜çš„</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">records: <span class="type">Union</span>[QuerySet, <span class="type">List</span>[MyModel]]</span>):</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h3 id="Protocol"><a href="#Protocol" class="headerlink" title="Protocol"></a>Protocol</h3><p>åè®®ç±»å‹æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„åŒ–ç±»å‹ï¼Œå®ƒè¡¨ç¤ºä¸€ç§é™æ€çš„é¸­å­ç±»å‹ï¼Œæœ‰ç‚¹åƒæ˜¯ Go ä¸­çš„æ¥å£å®šä¹‰ï¼Œä½†ä¾æ—§åªå­˜åœ¨äºâ€œç¼–ç æ—¶â€ã€‚<code>Protocol</code> çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ˜ç¡®çš„å®šä¹‰å’Œä½¿ç”¨é¸­å­ç±»å‹ï¼Œè€Œä¸ç”¨äººå·¥æ ¸å¯¹æ–¹æ³•çš„è¾“å…¥è¾“å‡ºã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span>, <span class="type">Optional</span>, Protocol</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Exitable</span>(<span class="title class_ inherited__">Protocol</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">exit</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>: ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Quittable</span>(<span class="title class_ inherited__">Protocol</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">quit</span>(<span class="params">self</span>) -&gt; <span class="type">Optional</span>[<span class="built_in">int</span>]: ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">finish</span>(<span class="params">task: <span class="type">Union</span>[Exitable, Quittable]</span>) -&gt; <span class="built_in">int</span>: ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QuitJob</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">quit</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExitJob</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">exit</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Server</span>: </span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">run_forever</span>(<span class="params">self</span>): -&gt; NoReturn:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;no return&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">finish(QuitJob()) <span class="comment"># OK</span></span><br><span class="line">finish(ExitJob()) <span class="comment"># OK</span></span><br><span class="line">finish(Server()) <span class="comment"># Error</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ç§åè®®ï¼Œ<code>Exitable</code> å’Œ <code>Quittable</code>ï¼ŒåŒæ—¶åœ¨ä¼ å‚æ—¶æ”¯æŒå®ƒä»¬ä¿©çš„å¹¶é›†ï¼Œé‚£ä¹ˆåªè¦å®ç°äº† <code>exit(self) -&gt; int</code> æˆ– <code>quit(self) -&gt; int</code> çš„å¯¹è±¡éƒ½ä¼šè¢«æ¥å—ã€‚</p>
<p>å…³äº <code>Protocol</code> çš„å…¶ä»–å®šä¹‰å’Œç¤ºä¾‹ï¼Œå¯ä»¥é€šè¿‡ <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0544">PEP 544</a> äº†è§£æ›´å¤šï¼Œè¿™é‡Œå°±ä¸å†å±•å¼€äº†ã€‚</p>
<h3 id="è‡ªå®šä¹‰ç±»å‹"><a href="#è‡ªå®šä¹‰ç±»å‹" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹"></a>è‡ªå®šä¹‰ç±»å‹</h3><h3 id="æ™®é€šç”¨æ³•"><a href="#æ™®é€šç”¨æ³•" class="headerlink" title="æ™®é€šç”¨æ³•"></a>æ™®é€šç”¨æ³•</h3><p>å¯ä»¥ä½¿ç”¨ <code>Type</code> æ¥æ¥å—å­ç±»</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Type</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>: ...</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicUser</span>(<span class="title class_ inherited__">User</span>): ...</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProUser</span>(<span class="title class_ inherited__">User</span>): ...</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TeamUser</span>(<span class="title class_ inherited__">User</span>): ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Accepts User, BasicUser, ProUser, TeamUser, ...</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_new_user</span>(<span class="params">user_class: <span class="type">Type</span>[User]</span>) -&gt; User:</span><br><span class="line">	<span class="keyword">return</span> user_class()</span><br></pre></td></tr></table></figure>

<h3 id="ç±»å‹è‡ªå®šä¹‰æ—¶"><a href="#ç±»å‹è‡ªå®šä¹‰æ—¶" class="headerlink" title="ç±»å‹è‡ªå®šä¹‰æ—¶"></a>ç±»å‹è‡ªå®šä¹‰æ—¶</h3><p>ä¸ä½¿ç”¨ <code>TypeVar</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">newborn</span>(<span class="params">cls, name: <span class="built_in">str</span></span>) -&gt; <span class="string">&#x27;Animal&#x27;</span>:</span><br><span class="line">	<span class="keyword">return</span> cls(name, date.today())</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä¸Šé¢æåˆ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ <code>TypeVar</code> æ¥åˆ›é€ ç±»å‹ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TAnimal = TypeVar(<span class="string">&quot;TAnimal&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>(<span class="type">Generic</span>(<span class="string">&quot;TAnimal&quot;</span>)):</span><br><span class="line"><span class="meta">	@classmethod</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">newborn</span>(<span class="params">cls, name: <span class="built_in">str</span></span>) -&gt; TAnimal:</span><br><span class="line">		<span class="keyword">return</span> cls(name, date.today())</span><br></pre></td></tr></table></figure>

<p>å€˜è‹¥æ­¤æ—¶è¿˜æœ‰ç»§æ‰¿ï¼Œéœ€è¦æ·»åŠ å‚æ•° <code>bound</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Type</span>, TypeVar</span><br><span class="line"></span><br><span class="line">TAnimal = TypeVar(<span class="string">&quot;TAnimal&quot;</span>, bound=<span class="string">&quot;Animal&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line"><span class="meta">	@classmethod</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">newborn</span>(<span class="params">cls: <span class="type">Type</span>[TAnimal], name: <span class="built_in">str</span></span>) -&gt; TAnimal:</span><br><span class="line">		<span class="keyword">return</span> cls(name, date.today())</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">bark</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> says woof!&quot;</span>)</span><br><span class="line"></span><br><span class="line">fido = Dog.newborn(<span class="string">&quot;Fido&quot;</span>)</span><br><span class="line">fido.bark()</span><br></pre></td></tr></table></figure>

<h3 id="è¾…åŠ©å‡½æ•°"><a href="#è¾…åŠ©å‡½æ•°" class="headerlink" title="è¾…åŠ©å‡½æ•°"></a>è¾…åŠ©å‡½æ•°</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬å¹¶ä¸æƒ³åœ¨ç®€å•ç±»å‹ä¸Šå¤šè´¹ç²¾åŠ›ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¾…åŠ©å‡½æ•°æ¥å¿«æ·åˆ›å»ºç±»å‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> NewType</span><br><span class="line"></span><br><span class="line">UserId = NewType(<span class="string">&#x27;UserId&#x27;</span>, <span class="built_in">int</span>)</span><br><span class="line">some_id = UserId(<span class="number">524313</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç±»å‹å¯ä»¥å†æ¬¡è¢«åˆ›å»º</span></span><br><span class="line">ProUserId = NewType(<span class="string">&#x27;ProUserId&#x27;</span>, UserId)</span><br><span class="line">some_pro_id = ProUserId(<span class="number">12345</span>)</span><br></pre></td></tr></table></figure>

<h2 id="typing-extensions"><a href="#typing-extensions" class="headerlink" title="typing-extensions"></a>typing-extensions</h2><p>ç”±äº <code>typing</code> æ¨¡å—å·²ç»è¢«å¼•å…¥æ ‡å‡†åº“ï¼Œå…¶å‘å¸ƒé¢‘ç‡éœ€è¦å’Œ Python å‘è¡Œç‰ˆä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šæ–°ç±»å‹è¢«æ”¾åˆ°äº† <code>typing-extensions</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>pip</code> å®‰è£…å®ƒã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install typing-extensions</span><br></pre></td></tr></table></figure>

<p><code>typing-extensions</code>ä¸­æœ‰å¾ˆå¤šç‰¹æ®Šç±»å‹ï¼Œä¸‹é¢æˆ‘ä»¬ç®€å•ä¸¾ä¸€ä¸ªå°ä¾‹å­ï¼Œå…¶ä»–çš„å¤§å®¶å¯ä»¥è‡ªè¡Œæ¢ç´¢ã€‚</p>
<h3 id="å®ä¾‹ï¼šç®€åŒ–çš„æšä¸¾ç±»å‹"><a href="#å®ä¾‹ï¼šç®€åŒ–çš„æšä¸¾ç±»å‹" class="headerlink" title="å®ä¾‹ï¼šç®€åŒ–çš„æšä¸¾ç±»å‹"></a>å®ä¾‹ï¼šç®€åŒ–çš„æšä¸¾ç±»å‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> <span class="type">Literal</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Literal è¡¨ç¤ºå­—é¢ç±»å‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_data</span>(<span class="params">raw: <span class="type">Literal</span>[<span class="string">&quot;red&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;yellow&quot;</span>]</span>) -&gt; <span class="built_in">bytes</span>: ...</span><br></pre></td></tr></table></figure>

<p>åŸåˆ™ä¸Šè¿™é‡Œå°±åªèƒ½è¾“å…¥å­—ç¬¦ä¸² â€œredâ€ â€œblueâ€ â€œyellowâ€ï¼ŒæŸäº›ç®€å•çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸ç”¨é¢å¤–å®šä¹‰æšä¸¾ç±»å‹ã€‚</p>
<h2 id="å·¥ç¨‹æŠ€å·§"><a href="#å·¥ç¨‹æŠ€å·§" class="headerlink" title="å·¥ç¨‹æŠ€å·§"></a>å·¥ç¨‹æŠ€å·§</h2><h3 id="é¿å…å¾ªç¯å¼•ç”¨"><a href="#é¿å…å¾ªç¯å¼•ç”¨" class="headerlink" title="é¿å…å¾ªç¯å¼•ç”¨"></a>é¿å…å¾ªç¯å¼•ç”¨</h3><p>A æ¨¡å—ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> B <span class="keyword">import</span> AppFooController</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">		<span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_app</span>():</span><br><span class="line">	controller = AppFooController(App(<span class="string">&#x27;bar&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼ŒB æ¨¡å—å¹¶ä¸æ˜¯çœŸæ­£çš„éœ€è¦å¼•ç”¨ A æ¨¡å—çš„å†…å®¹ï¼Œè€Œæ˜¯éœ€è¦è·å¾— A æ¨¡å—å†…å®¹çš„ <code>typing hint</code>ï¼Œå¦‚æœç›´æ¥å¼•ç”¨ä¼šå¯¼è‡´å¾ªç¯ importï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•è§„é¿ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TYPE_CHECKING</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> TYPE_CHECKING:</span><br><span class="line">    <span class="keyword">from</span> A <span class="keyword">import</span> App</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppFooController</span>:</span><br><span class="line">    <span class="comment"># æ³¨æ„ï¼šTYPE_CHECKING è¯­å¥ä¸‹ import çš„å†…å®¹ï¼Œéƒ½å¿…é¡»ç”¨å¼•å·åŒ…è£¹</span></span><br><span class="line">    app: <span class="string">&#x27;App&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <code>TYPING_CHECKING</code> åœ¨è¿è¡Œæ—¶å°†æ°¸è¿œä¸º <code>False</code>ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šçœŸæ­£ import A æ¨¡å—ï¼ŒåŒæ—¶ä¹Ÿèƒ½èµ·åˆ° <code>hint</code> çš„ä½œç”¨ã€‚</p>
<h2 id="mypy"><a href="#mypy" class="headerlink" title="mypy"></a>mypy</h2><p><a target="_blank" rel="noopener" href="https://github.com/python/mypy">mypy</a> åŸæ¥æ˜¯ä¸€ä¸ªå…¼å®¹å¤§éƒ¨åˆ† Python è¯­æ³•çš„é™æ€ç±»å‹çš„ Python å‘è¡Œç‰ˆï¼Œåæ¥åœ¨å®˜æ–¹å—åˆ°å¯å‘ï¼Œå¹¶åŠ å…¥ç±»å‹æ³¨è§£ä¹‹åï¼Œmypy å·²ç»æ¼”åŒ–æˆäº†ä¸€ä¸ªé™æ€ç±»å‹æ£€æŸ¥å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ pip æ¥å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mypy</span><br></pre></td></tr></table></figure>

<p>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ mypy æ¥å¯¹é¡¹ç›®è¿›è¡Œå…¨å±€æ‰«æ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">âœ mypy some-python-project-path/</span><br><span class="line">foo/utils/sanitizer.py:18: error: Cannot find module named <span class="string">&#x27;bleach.encoding&#x27;</span></span><br><span class="line">foo/utils/sanitizer.py:19: error: Cannot find module named <span class="string">&#x27;bleach.sanitizer&#x27;</span></span><br><span class="line">foo/fake/tee/gitlab/client.py:5: error: Cannot find module named <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">foo/fake/tee/gitlab/client.py:6: error: Cannot find module named <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">foo/fake/tee/gitlab/client.py:7: error: Cannot find module named <span class="string">&#x27;bar.objects&#x27;</span></span><br><span class="line">foo/accessories/fake/tags.py:48: error: <span class="string">&quot;type&quot;</span> has no attribute <span class="string">&quot;tag_type&quot;</span></span><br><span class="line">foo/utils/log.py:4: error: Cannot find module named <span class="string">&#x27;logstash&#x27;</span></span><br><span class="line">foo/utils/log.py:5: error: No library stub file <span class="keyword">for</span> module <span class="string">&#x27;redis&#x27;</span></span><br><span class="line">foo/utils/detector.py:32: error: Need <span class="built_in">type</span> annotation <span class="keyword">for</span> <span class="string">&#x27;detect_map&#x27;</span></span><br><span class="line">foo/utils/basic.py:3: error: Cannot find module named <span class="string">&#x27;past.utils&#x27;</span></span><br><span class="line">foo/utils/basic.py:9: error: Cannot find module named <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">foo/utils/basic.py:10: error: Cannot find module named <span class="string">&#x27;aenum&#x27;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬é¡¹ç›®æ•´ä½“ç±»å‹æ³¨è§£å®Œå–„çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘å°† mypy æ”¾åˆ° CI çš„æµç¨‹ä¸­ã€‚</p>
<p>æ¯”å¦‚ <a target="_blank" rel="noopener" href="https://github.com/tornadoweb/tornado">Tornado</a> çš„æºç åŸºæœ¬å·²ç»åšåˆ° 100% é™æ€äº†ï¼Œæ‰«ææ•´ä¸ªå·¥ç¨‹åªæœ‰ä¸¤ä¸ªå°é—®é¢˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ mypy tornado/</span><br><span class="line">tornado/testing.py:263: error: Return <span class="built_in">type</span> of <span class="string">&quot;run&quot;</span> incompatible with supertype <span class="string">&quot;TestCase&quot;</span></span><br><span class="line">tornado/testing.py:270: error: Incompatible <span class="built_in">return</span> value <span class="built_in">type</span> (got <span class="string">&quot;Optional[TestResult]&quot;</span>, expected <span class="string">&quot;TestCase&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="å†è®©æˆ‘ä»¬çœ‹çœ‹é‚£ä¸ªä¾‹å­"><a href="#å†è®©æˆ‘ä»¬çœ‹çœ‹é‚£ä¸ªä¾‹å­" class="headerlink" title="å†è®©æˆ‘ä»¬çœ‹çœ‹é‚£ä¸ªä¾‹å­"></a>å†è®©æˆ‘ä»¬çœ‹çœ‹é‚£ä¸ªä¾‹å­</h2><p>ä»¥ä¸‹æ˜¯åœ¨ Pycharm é‡Œæç¤ºçš„æ ·å­ï¼š</p>
<p><img src="/../images/%F0%9F%90%8D%20%E8%AE%A9%E4%BD%A0%E7%9A%84%20Python%20%E9%9D%99%E6%80%81%E8%B5%B7%E6%9D%A5/Untitled.png"></p>
<p>å¥½äº†ï¼Œåªè¦åŠ ä¸Šäº†ç±»å‹æ³¨è§£ï¼Œé‚£ä¸ª <strong>ä¼å›¾è®©æ‰€æœ‰å˜é‡éƒ½å˜æˆå…ƒç»„</strong> çš„â€å…ƒå‡¶â€â€”â€”é€—å·ï¼Œå°±æ— å¤„éå½¢äº† xD</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ç±»å‹æ³¨è§£ç»™ Python å¸¦æ¥äº†å…¨æ–°çš„å¼€å‘ä½“éªŒï¼Œç›¸ä¿¡æ­¤åˆ»çš„ä½ ä¹Ÿæœ‰äº†ç­”æ¡ˆï¼Œè®© Python â€œé™æ€â€ èµ·æ¥å§ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.to/dstarner/using-pythons-type-annotations-4cfe">Using Pythonâ€™s Type Annotations</a></li>
<li><a target="_blank" rel="noopener" href="https://realpython.com/python-type-checking/">The Ultimate Guide to Python Type Checking</a></li>
<li><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0483/">PEP 483</a></li>
<li><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0484/">PEP 484</a></li>
<li><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/typing.html">typing library</a></li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Blues Yu</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://emergencyexit.xyz/python-type-hint.html">https://emergencyexit.xyz/python-type-hint.html</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2025 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/python/"># python</a>
                    
                        <a href="/tags/tech/"># tech</a>
                    
                        <a href="/tags/pep/"># pep</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/django-orm-best-practice.html">ğŸ‘¹ Django ORMï¼šå¤©ä½¿ä¸é­”é¬¼</a>
            
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© Blues Yu | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>
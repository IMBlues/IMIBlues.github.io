<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Blues Yu">





<title>ç”¨ GraphQL æŸ¥è¯¢ä½ çš„ Django åº”ç”¨ | å¸ƒé²æ–¯é±¼çš„å¦™æƒ³å¤©å¼€</title>



    <link rel="icon" href="/favicon.svg">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">å¸ƒé²æ–¯é±¼çš„å¦™æƒ³å¤©å¼€</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">æŠ€æœ¯</a>
                
                    <a class="menu-item" href="/category">ç”Ÿæ´»</a>
                
                    <a class="menu-item" href="/tag">æ ‡ç­¾</a>
                
                    <a class="menu-item" href="/about">å…³äºæˆ‘</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">å¸ƒé²æ–¯é±¼çš„å¦™æƒ³å¤©å¼€</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">æŠ€æœ¯</a>
                
                    <a class="menu-item" href="/category">ç”Ÿæ´»</a>
                
                    <a class="menu-item" href="/tag">æ ‡ç­¾</a>
                
                    <a class="menu-item" href="/about">å…³äºæˆ‘</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">ç”¨ GraphQL æŸ¥è¯¢ä½ çš„ Django åº”ç”¨</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Blues Yu</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">November 27, 2021&nbsp;&nbsp;16:26:50</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <blockquote>
<p>ğŸ˜¶â€ğŸŒ«ï¸ å…¨æ–‡ä»¥åç«¯å¼€å‘è§†è§’å†™ä½œï¼Œéƒ¨åˆ†æ¶‰åŠåˆ°å‰ç«¯å¼€å‘çš„ä»‹ç»å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–è€…ä¸å‡†ç¡®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæ–§æ­£</p>
</blockquote>
<h2 id="ä»€ä¹ˆæ˜¯-GraphQL-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-GraphQL-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ GraphQL ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ GraphQL ï¼Ÿ</h2><p>å…ˆæ¥çœ‹çœ‹ <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/GraphQL">wikipedia</a>ï¼š</p>
<blockquote>
<p>GraphQL æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œé¢å‘ API è€Œåˆ›é€ å‡ºæ¥çš„æ•°æ®æŸ¥è¯¢æ“ä½œè¯­è¨€ä»¥åŠç›¸åº”çš„æœåŠ¡ç«¯è¿è¡Œç¯å¢ƒã€‚</p>
</blockquote>
<p>GraphQL é¦–å…ˆæ˜¯ä¸€ç§æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§é€šç”¨çš„æ•°æ®æŸ¥è¯¢æ–¹å¼ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ç§é€šç”¨çš„ SQLï¼Œåªä¸è¿‡å‰è€…é¢å‘æŠ½è±¡çš„æ•°æ®é›†ï¼Œåè€…å¾€å¾€æ˜¯å…·ä½“çš„å…³ç³»å‹æ•°æ®åº“ã€‚</p>
<p>å…¶æ¬¡ï¼Œå®ƒè¿˜åŒ…æ‹¬ä¸€ç§æœåŠ¡ç«¯è¿è¡Œæ—¶ï¼Œç”¨äºå®ç°æŸ¥è¯¢è¯­å¥è§£æã€æ•°æ®ç±»å‹å®šä¹‰ã€‚</p>
<h2 id="å®ƒæœ‰ä»€ä¹ˆæœ‰æ„æ€çš„ç‰¹æ€§"><a href="#å®ƒæœ‰ä»€ä¹ˆæœ‰æ„æ€çš„ç‰¹æ€§" class="headerlink" title="å®ƒæœ‰ä»€ä¹ˆæœ‰æ„æ€çš„ç‰¹æ€§"></a>å®ƒæœ‰ä»€ä¹ˆæœ‰æ„æ€çš„ç‰¹æ€§</h2><p>ä»…ä»åç«¯å¼€å‘è§†è§’ï¼Œåˆ—ä¸¾å‡ ä¸ªè§‰å¾—æœ‰æ„æ€çš„ç‰¹æ€§</p>
<h3 id="Fragments"><a href="#Fragments" class="headerlink" title="Fragments"></a>Fragments</h3><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> HeroComparison<span class="punctuation">(</span><span class="variable">$first</span>: Int <span class="punctuation">=</span> <span class="number">3</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="symbol">leftComparison</span><span class="punctuation">:</span> hero<span class="punctuation">(</span><span class="symbol">episode</span><span class="punctuation">:</span> EMPIRE<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">...</span>comparisonFields</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="symbol">rightComparison</span><span class="punctuation">:</span> hero<span class="punctuation">(</span><span class="symbol">episode</span><span class="punctuation">:</span> JEDI<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">...</span>comparisonFields</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fragment</span> comparisonFields <span class="keyword">on</span> Character <span class="punctuation">&#123;</span></span><br><span class="line">  name</span><br><span class="line">  friendsConnection<span class="punctuation">(</span><span class="symbol">first</span><span class="punctuation">:</span> <span class="variable">$first</span>) <span class="punctuation">&#123;</span></span><br><span class="line">    totalCount</span><br><span class="line">    edges <span class="punctuation">&#123;</span></span><br><span class="line">      node <span class="punctuation">&#123;</span></span><br><span class="line">        name</span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ Fragment å¤ç”¨æŸ¥è¯¢å†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥å®šä¹‰å‚æ•°</p>
<h3 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h3><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> Hero<span class="punctuation">(</span><span class="variable">$episode</span>: Episode, <span class="variable">$withFriends</span>: Boolean<span class="punctuation">!</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  hero<span class="punctuation">(</span><span class="symbol">episode</span><span class="punctuation">:</span> <span class="variable">$episode</span>) <span class="punctuation">&#123;</span></span><br><span class="line">    name</span><br><span class="line">    friends <span class="meta">@include</span><span class="punctuation">(</span><span class="symbol">if</span><span class="punctuation">:</span> <span class="variable">$withFriends</span>) <span class="punctuation">&#123;</span></span><br><span class="line">      name</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># variables</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="string">&quot;episode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JEDI&quot;</span>,</span><br><span class="line">  <span class="string">&quot;withFriends&quot;</span><span class="punctuation">:</span> <span class="literal">false</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡é€šç”¨çš„ä¸¤ç§æŒ‡ä»¤æ¥æ§åˆ¶ä¸€äº›å­—æ®µçš„è¿”å›ï¼š</p>
<ul>
<li><code>@include(if: Boolean)</code></li>
<li><code>@skip(if: Boolean)</code></li>
</ul>
<h2 id="å’Œ-REST-ç›¸æ¯”è¾ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Ÿ"><a href="#å’Œ-REST-ç›¸æ¯”è¾ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Ÿ" class="headerlink" title="å’Œ REST ç›¸æ¯”è¾ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Ÿ"></a>å’Œ REST ç›¸æ¯”è¾ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼Ÿ</h2><h3 id="TLDR"><a href="#TLDR" class="headerlink" title="TLDR"></a>TLDR</h3><p>REST æ›´å¤šæ˜¯ä» HTTP åè®®å‡ºå‘çš„ä¸€ç§çº¦å®šåè®®ï¼Œå› ä¸ºå—åˆ¶äº HTTP åè®®æœ¬èº«çš„è®¾è®¡ï¼Œåœ¨<strong>è¡¨è¾¾èƒ½åŠ›</strong>ä¸Šæ˜¯å¼±äº<strong>ä½œä¸ºæŸ¥è¯¢è¯­è¨€</strong>çš„ GraphQL çš„ã€‚</p>
<p>åŒæ—¶ï¼ŒREST é€šå¸¸éƒ½æ˜¯ç”±åç«¯å¼€å‘è€…ä¸»åŠ¨å°è£…ï¼Œè€Œ GraphQL åˆ™æ˜¯ç”±å‰ç«¯ä¸»åŠ¨æ‹¼è£…ã€‚</p>
<p>æ‰€ä»¥å¦‚æœé¢å¯¹çš„åœºæ™¯æ˜¯å‰ç«¯éœ€æ±‚å¤æ‚è€Œå¤šå˜ï¼ŒGraphQL è‚¯å®šæ¯” REST æ›´é€‚åˆå¿«é€Ÿè¿­ä»£ã€‚</p>
<p>ä¹Ÿæ­£å› æ­¤ï¼ŒGraphQL åœ¨å®ç°ä¸Šæ›´åŠ ç¹å¤ï¼Œæ‰€ä»¥é¢å¯¹ API æ•°é‡å°‘ã€éœ€æ±‚ä¸ä¼šè½»æ˜“çš„åœºæ™¯æ—¶ï¼ŒREST åè€Œæ˜¯æ›´é€‚åˆçš„æŠ€æœ¯é€‰å‹ã€‚</p>
<p>*ä½œä¸ºåç«¯å¼€å‘ï¼Œå­¦ä¹ å’Œä½¿ç”¨ GraphQL çš„åŠ¨åŠ›ï¼Œæ›´å¤šæ˜¯**æƒ³å°†è‡ªå·±ä» CRUD çš„æ³¥æ²¼ä¸­æ‹¯æ•‘å‡ºæ¥ï¼Œ*<em>å°†æ›´å¤šçš„ç²¾åŠ›æ”¾åœ¨å…¶ä»–æ›´é‡è¦çš„æŠ€æœ¯ä¸Šã€‚</em></p>
<h3 id="vs-æ‰©å±•çš„-REST-åè®®"><a href="#vs-æ‰©å±•çš„-REST-åè®®" class="headerlink" title="vs æ‰©å±•çš„ REST åè®®"></a>vs æ‰©å±•çš„ REST åè®®</h3><p>ï¼ˆæ­¤å°èŠ‚ä¸­å›¾ç‰‡æ‹·è´è‡ª<a target="_blank" rel="noopener" href="https://www.howtographql.com/basics/1-graphql-is-th">ç½‘ç»œ</a>ï¼Œæ‡’å¾—ç”»ï¼‰</p>
<p>å’Œ REST ä¸€æ ·ï¼ŒGraphQL å¹¶ä¸æ˜¯ä»€ä¹ˆå¼€å‘æ¡†æ¶ï¼Œå®ƒåªæ˜¯å®šä¹‰äº†ä¸€ç§é€šç”¨å‹æŸ¥è¯¢çš„ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>ã€‚</p>
<p>è€Œä½¿ç”¨ REST åè®®è¿›è¡Œèµ„æºæ‹‰å–ï¼Œæˆ‘ä»¬æ€»æ˜¯ä¼šé¢ä¸´ä¸€äº›å®é™…çš„é—®é¢˜ï¼Œè€Œ GraphQL å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³ã€‚é‚£ä¹ˆè‚¯å®šä¼šæœ‰åŒå­¦åœ¨æƒ³ï¼ŒREST æ˜¯éå¸¸çµæ´»çš„ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡è‡ªå»ºä¸€ä¸ªæŸ¥è¯¢è¯­æ³•ï¼Œå¼¥è¡¥ä¸Šè¿°çš„ REST ç¼ºé™·ï¼Œä½•å¿…è¦å¦å¤–å¼•å…¥ GraphQL å¾’å¢å¤æ‚åº¦å‘¢ã€‚</p>
<p>è¯´çš„æ²¡é”™ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é˜è¿°è¿™äº›é—®é¢˜çš„æ—¶å€™ï¼Œä¹Ÿä¼šé™„ä¸Šæˆ‘ä»¬å½“å‰åŸºäº REST çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>Overfetchingï¼š</strong></p>
<p>å‡å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>/comments</code> çš„ APIï¼Œè¾“å‡ºè¯„è®ºåˆ—è¡¨ã€‚ä»¥ <a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/">django-rest-framework</a> ä¸ºä¾‹ï¼Œæˆ‘ä»¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ª <code>Serializer</code> æ¥å£°æ˜å®ƒçš„è¾“å…¥å’Œè¾“å‡ºã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommentSerializer</span>(serializers.Serializer):</span><br><span class="line">    email = serializers.EmailField()</span><br><span class="line">    content = serializers.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    logo = serializer.ImageField()</span><br><span class="line">    ...(çœç•¥æ•°ä¸æ¸…çš„å­—æ®µ)</span><br><span class="line">    created = serializers.DateTimeField()</span><br><span class="line">    ip_from = serializers.IPAddressField()</span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥ç¬¦åˆå¸¸ç†ï¼Œå®ƒå¯ä»¥è½»æ¾æ»¡è¶³å¤§å¤šæ•°è¯„è®ºåˆ—è¡¨çš„éœ€æ±‚ã€‚ä½†æ˜¯ä¹Ÿè®¸æŸä¸€å¤©ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¯„è®ºçš„ç²¾ç®€åˆ—è¡¨çš„ APIï¼Œå½“å‰è¿”å›å†…å®¹ä¸­ï¼Œé™¤äº† <code>content</code> ä»¥å¤–çš„å…¶ä»–å­—æ®µéƒ½å˜æˆå¤šä½™äº†ï¼Œé‚£ä¹ˆåç«¯å¼€å‘éœ€è¦é‡æ–°å®šä¸€ä¸ª <code>MinimalCommentSerializer</code> æ¥æ»¡è¶³æ–°çš„éœ€æ±‚ã€‚</p>
<p>åœ¨ REST åŸºç¡€ä¸­ï¼Œæˆ‘ä»¬å¢åŠ äº† <code>fields</code> å‚æ•°ï¼Œå¹¶åœ¨ <code>DRF Serializer</code> é‡Œåšäº†<a target="_blank" rel="noopener" href="https://github.com/TencentBlueKing/bk-user/blob/8c633e0a3821beb839ed120c4514c5733e675862/src/api/bkuser_core/common/viewset.py#L71">ç‰¹æ®Šå¤„ç†ï¼ˆä½ å¯ä»¥ç‚¹å‡»æŸ¥çœ‹æºç ï¼‰</a>ï¼Œå®ç°çš„å…·ä½“æ•ˆæœï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢ commentï¼Œå¹¶é™åˆ¶ç»“æœè¿”å›å­—æ®µ</span><br><span class="line">/api/comments?fields=email<span class="punctuation">,</span>content</span><br><span class="line"></span><br><span class="line"># è¿”å›</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;results&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;foo@bar.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;I love this blog, simple and good looking.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ GraphQLï¼Œå†™æ³•ä¸Šä¼šæ›´è‡ªç„¶ï¼š</p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  comment <span class="punctuation">&#123;</span></span><br><span class="line">    email</span><br><span class="line">    content</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Underfetching</strong></p>
<p>ç›¸è¾ƒäº Overfetching æ˜¯è·å–äº†è¿‡å¤šæ•°æ®ï¼ŒUnderfetching åˆ™æ˜¯åœ¨è¯·æ±‚è·å–çš„æ•°æ®ä¸è¶³å¤Ÿæ»¡è¶³éœ€æ±‚ã€‚</p>
<p><img src="/../images/%E7%94%A8%20GraphQL%20%E6%9F%A5%E8%AF%A2%E4%BD%A0%E7%9A%84%20Django%20%E5%BA%94%E7%94%A8/Untitled.png"></p>
<p>ä¼ ç»Ÿçš„ REST åè®®</p>
<p>å‡å¦‚æˆ‘ä»¬éœ€è¦è·å–æ‰€æœ‰ç”¨æˆ·ç»´åº¦çš„è¯„è®ºï¼Œæˆ‘ä»¬éœ€è¦å…ˆè·å–é€šè¿‡ <code>/users</code> æ‰€æœ‰ç”¨æˆ· idï¼Œå†ä½¿ç”¨ id åˆ—è¡¨éå†æŸ¥è¯¢ <code>/users/&lt;id&gt;/comments</code> æ¥è·å–ç›¸å…³çš„åˆ—è¡¨ã€‚</p>
<p>åœ¨ REST ä¸­ï¼Œä¸ºäº†è¿™ä¸ªéœ€æ±‚æˆ‘ä»¬å¯èƒ½ä¼šé¢å¤–ä¸º <code>/users</code> å¢åŠ ä¸€ä¸ªå‚æ•° <code>with_comments</code> </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢ usersï¼Œå¹¶é™åˆ¶ç»“æœè¿”å›å­—æ®µ</span><br><span class="line">/api/users?with_comments=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"># è¿”å›</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;results&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;foo&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;telephone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;12345&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;comments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;foo@bar.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;I love this blog, simple and good looking.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç›¸è¾ƒäºè‡ªå®šä¹‰çš„ REST åè®®ï¼Œä½¿ç”¨ GraphQL å¯ä»¥æ›´ç®€å•ï¼š</p>
<p><img src="/../images/%E7%94%A8%20GraphQL%20%E6%9F%A5%E8%AF%A2%E4%BD%A0%E7%9A%84%20Django%20%E5%BA%94%E7%94%A8/Untitled%201.png"></p>
<p>ä½¿ç”¨ GraphQLï¼Œåªéœ€è¦ä¸€æ¬¡è¯·æ±‚</p>
<hr>
<p>ç›¸ä¿¡é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹å‡ºï¼Œç›¸è¾ƒäº GraphQL ï¼ŒåŸºäº REST æ‰©å±•åè®®å­˜åœ¨è¿™äº›é—®é¢˜ï¼š</p>
<ul>
<li>ä¸å¤Ÿé€šç”¨ï¼Œç”¨æˆ·æœ‰é¢å¤–çš„å­¦ä¹ æˆæœ¬ï¼Œå¢åŠ äº†é¢å¤–çš„æ–‡æ¡£è´Ÿæ‹…ã€‚</li>
<li>åŸºäº REST ï¼Œå•ä¸ªè¯·æ±‚åªèƒ½é’ˆå¯¹å•ä¸ªå¯¹è±¡è¿›è¡Œæè¿°ã€‚éœ€è¦ç­‰å¾…éœ€æ±‚æ²‰æ·€ï¼Œç”±åç«¯ä¸»åŠ¨å°è£…ï¼Œè¿­ä»£èŠ‚å¥ä¼šæ›´æ…¢ã€‚</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯-GraphQL-å®¢æˆ·ç«¯"><a href="#ä»€ä¹ˆæ˜¯-GraphQL-å®¢æˆ·ç«¯" class="headerlink" title="ä»€ä¹ˆæ˜¯ GraphQL å®¢æˆ·ç«¯?"></a>ä»€ä¹ˆæ˜¯ GraphQL å®¢æˆ·ç«¯?</h2><p>æˆ‘ä»¬ä¸»è¦èšç„¦äº GraphQL æœåŠ¡ç«¯æä¾›ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦å…ˆçœ‹ä¸€ä¸‹æ‰€è°“çš„å®¢æˆ·ç«¯ç©¶ç«Ÿåšäº†ä»€ä¹ˆã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œè¦æƒ³åœ¨åŸç”Ÿ Javascript ä¸­ç›´æ¥ä½¿ç”¨ GraphQL å¹¶ä¸æ˜¯ä¸€ä»¶ç‰¹åˆ«å®¹æ˜“çš„äº‹ï¼Œéœ€è¦ä¸€äº›åº“æ¥ååŠ©æ‹‰å–å’Œç®¡ç† GraphQL æ•°æ®ã€‚</p>
<p>ç›¸è¾ƒäºåŸç”Ÿçš„ GraphQL ï¼Œå®¢æˆ·ç«¯ä¸»è¦è§£å†³äº†å‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯æ•°æ®æ‹‰å–ç¼“å­˜é—®é¢˜ï¼ˆåŒ…æ‹¬ç¼“å­˜ä¸€è‡´æ€§ã€æ›´æ–°ç¼“å­˜ç­‰ï¼‰</li>
<li>æ•°æ®åˆ†é¡µã€å£°æ˜å¼æ•°æ®è·å–</li>
<li>â€¦</li>
</ul>
<p>ä¸»æµçš„å®¢æˆ·ç«¯æ¡†æ¶ä¸»è¦æœ‰ä¸¤ç§â€”â€” <a target="_blank" rel="noopener" href="https://relay.dev/">Relay</a> å’Œ <a target="_blank" rel="noopener" href="https://www.apollographql.com/">Apollo</a> ï¼Œæˆ‘ä»¬ä»…ä»æœ‰é™çš„è§’åº¦æ¥çœ‹ä¸‹äºŒè€…çš„å¼‚åŒï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>Relay</th>
<th>Apollo</th>
</tr>
</thead>
<tbody><tr>
<td>æ¡†æ¶æ”¯æŒ</td>
<td>ä»…æ”¯æŒ React, React Native</td>
<td>æ— æ¡†æ¶é™å®š</td>
</tr>
<tr>
<td>GraphQL API</td>
<td>éœ€è¦ç‰¹å®šçš„ Schema æ”¯æŒ</td>
<td>æ— éœ€ç‰¹å®šçš„ Schema æ”¯æŒ</td>
</tr>
<tr>
<td>å­¦ä¹ æˆæœ¬</td>
<td>è¾ƒé«˜</td>
<td>è¾ƒä½</td>
</tr>
<tr>
<td>ç”Ÿäº§åŠ›</td>
<td>é«˜</td>
<td>è¾ƒä½</td>
</tr>
<tr>
<td>çµæ´»æ€§</td>
<td>å›ºå®šç»“æ„</td>
<td>è¾ƒçµæ´»</td>
</tr>
<tr>
<td>æ˜¯å¦æ”¯æŒè®¢é˜…</td>
<td>å¦</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>ç®€è€Œè¨€ä¹‹ï¼ŒRealy æ›´å¤æ‚ï¼Œæ›´èƒ½å¤Ÿåº”å¯¹å¤§å‹åº”ç”¨ï¼ŒApollo æ›´è½»é‡ï¼Œä¸è¿‡éœ€è¦æ›´å¤šçš„æ‰‹å·¥åŠ³åŠ¨ã€‚</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="æœåŠ¡ç«¯è½åœ°ï¼šGraphQL-â†’-Django"><a href="#æœåŠ¡ç«¯è½åœ°ï¼šGraphQL-â†’-Django" class="headerlink" title="æœåŠ¡ç«¯è½åœ°ï¼šGraphQL â†’ Django"></a>æœåŠ¡ç«¯è½åœ°ï¼šGraphQL â†’ Django</h2><p>æƒ³è¦å°† GraphQL å¼•å…¥ç°æœ‰çš„é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸¤ä¸ªåŸºç¡€çš„ä¾èµ–ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/graphql-python/graphene-django">graphene-django</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/carltongibson/django-filter">django-filter</a></li>
</ul>
<p>äºŒè€…åˆ†åˆ«è´Ÿè´£ä¸¤éƒ¨åˆ†çš„å·¥ä½œï¼š</p>
<ul>
<li>Django Model â‡’  Schema</li>
<li>Query  â‡’  Filter Django Model</li>
</ul>
<h3 id="æ”¯æŒ-Relay"><a href="#æ”¯æŒ-Relay" class="headerlink" title="æ”¯æŒ Relay"></a>æ”¯æŒ Relay</h3><p>graphene-django æœ¬èº« <a target="_blank" rel="noopener" href="https://docs.graphene-python.org/projects/django/en/latest/tutorial-relay/">é»˜è®¤æ”¯æŒ Relay</a>ï¼Œæ‰€ä»¥ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°å¼€å¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> graphene <span class="keyword">import</span> relay</span><br><span class="line"><span class="keyword">from</span> graphene_django <span class="keyword">import</span> DjangoObjectType</span><br><span class="line"><span class="keyword">from</span> ingredients.models <span class="keyword">import</span> Category</span><br><span class="line"></span><br><span class="line"><span class="comment"># Graphene will automatically map the Category model&#x27;s fields onto the CategoryNode.</span></span><br><span class="line"><span class="comment"># This is configured in the CategoryNode&#x27;s Meta class (as you can see below)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CategoryNode</span>(<span class="title class_ inherited__">DjangoObjectType</span>):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Category</span><br><span class="line">        filter_fields = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;ingredients&#x27;</span>]</span><br><span class="line">        interfaces = (relay.Node, )</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡å¾ˆå¤šæ—¶å€™è€ƒè™‘åˆ° Relay çš„å¤æ‚åº¦ï¼Œæœ‰æ—¶éƒ½ä¸é€‚åˆå¼•å…¥ï¼Œæ›´ä½•å†µ Relay éœ€è¦ç‰¹æ®Šçš„ Schema æ”¯æŒï¼š</p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  allIngredients <span class="punctuation">&#123;</span></span><br><span class="line">    edges <span class="punctuation">&#123;</span></span><br><span class="line">      node <span class="punctuation">&#123;</span></span><br><span class="line">        id,</span><br><span class="line">        name</span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  allIngredients <span class="punctuation">&#123;</span></span><br><span class="line">    id</span><br><span class="line">    name</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™ graphene-django å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå½“ä¸ä½¿ç”¨ Relay æ—¶ï¼Œå­˜åœ¨ä¸€äº›åŠŸèƒ½ç¼ºå¤±ï¼š</p>
<ul>
<li>Fragment \ Directives</li>
<li>åˆ†é¡µã€è¿‡æ»¤</li>
<li>é€šè¿‡ DRF Serializer å®šä¹‰ Mutations</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥é¢å¤–çš„åº“æ¥è§£å†³ã€‚</p>
<h3 id="å¼•å…¥-graphene-django-extras"><a href="#å¼•å…¥-graphene-django-extras" class="headerlink" title="å¼•å…¥ graphene-django-extras"></a>å¼•å…¥ <a target="_blank" rel="noopener" href="https://github.com/eamigo86/graphene-django-extras">graphene-django-extras</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> graphene <span class="keyword">import</span> ObjectType</span><br><span class="line"><span class="keyword">from</span> graphene_django_extras <span class="keyword">import</span> DjangoListObjectField, DjangoListObjectType</span><br><span class="line"><span class="keyword">from</span> graphene_django_extras.paginations <span class="keyword">import</span> LimitOffsetGraphqlPagination</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommentListType</span>(<span class="title class_ inherited__">DjangoListObjectType</span>):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Comment</span><br><span class="line">        fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line">        pagination = LimitOffsetGraphqlPagination(default_limit=<span class="number">25</span>, ordering=<span class="string">&quot;-id&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Query</span>(<span class="title class_ inherited__">ObjectType</span>):</span><br><span class="line">    comments = DjangoListObjectField(CommentListType, description=<span class="string">&quot;Query all comments&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>æ”¯æŒå¤æ‚è¿‡æ»¤æŸ¥è¯¢</strong></p>
<p>å¯ä»¥åœ¨åˆ—è¡¨å¯¹è±¡ä¸­å¢åŠ  <code>filter_fields</code> ï¼Œé’ˆå¯¹ä¸åŒçš„å­—æ®µæ”¯æŒä¸åŒçš„ Django å¤æ‚æŸ¥è¯¢æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CommentListType</span>(<span class="title class_ inherited__">DjangoListObjectType</span>):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Comment</span><br><span class="line">        filter_fields = &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: [<span class="string">&quot;exact&quot;</span>, <span class="string">&quot;in&quot;</span>],</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: [<span class="string">&quot;exact&quot;</span>, <span class="string">&quot;icontains&quot;</span>, <span class="string">&quot;istartswith&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        pagination = LimitOffsetGraphqlPagination(default_limit=<span class="number">25</span>, ordering=<span class="string">&quot;-username&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥å°†ä¸€äº› Django çš„æŸ¥è¯¢èƒ½åŠ›é‡Šæ”¾åˆ°å‰ç«¯</p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  comments<span class="punctuation">(</span><span class="symbol">id__In</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span><span class="punctuation">]</span> <span class="symbol">content_Icontains</span><span class="punctuation">:</span> <span class="string">&quot;Amazing&quot;</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    totalCount</span><br><span class="line">    results<span class="punctuation">(</span><span class="symbol">limit</span><span class="punctuation">:</span> <span class="number">10</span> <span class="symbol">offset</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">      id</span><br><span class="line">      email</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>è‡ªå®šä¹‰æŸ¥è¯¢å­—æ®µ</strong></p>
<p>Django é»˜è®¤çš„æŸ¥è¯¢èƒ½åŠ›ï¼Œå¯¹äºä¸€äº›ç‰¹æ®Šå­—æ®µå¹¶ä¸èƒ½å®Œå…¨è¦†ç›–éœ€æ±‚ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦é’ˆå¯¹è¿™äº›å†…å®¹æ‰‹å†™ä¸€äº›å¤„ç†é€»è¾‘ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Query</span>(<span class="title class_ inherited__">ObjectType</span>):</span><br><span class="line">    user = Field(UserType, description=<span class="string">&quot;Retrieve certain user&quot;</span>, <span class="built_in">id</span>=Int(), username=String())</span><br><span class="line"></span><br><span class="line">		<span class="keyword">def</span> <span class="title function_">resolve_user</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, context: <span class="string">&quot;GraphQLResolveInfo&quot;</span>, <span class="built_in">id</span>: <span class="type">Optional</span>[<span class="built_in">int</span>] = <span class="literal">None</span>, username: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; User:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">id</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> User.objects.get(pk=<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;username or pk at least one is required&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># do some custom logic</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> User.objects.get(username=username)</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>resolve_</code> å‡½æ•°å»å¤„ç†æŸ¥è¯¢æ—¶ï¼ŒGraphQL å’Œ REST æœ¬è´¨ä¸Šåªæ˜¯æŸ¥è¯¢ DSL æœ‰æ‰€åŒºåˆ«ï¼Œéƒ½ä¼šé‡åˆ°ç±»ä¼¼åƒ <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/97197/what-is-the-n1-selects-problem-in-orm-object-relational-mapping">N+1</a> è¿™æ ·çš„æ…¢æŸ¥è¯¢é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦è°¨æ…åœ°å°†å‰ç«¯çš„æŸ¥è¯¢è½¬æ¢æˆå¯é çš„ Django ORM æŸ¥è¯¢ã€‚</p>
<h3 id="é‰´æƒ"><a href="#é‰´æƒ" class="headerlink" title="é‰´æƒ"></a>é‰´æƒ</h3><p>ç”±äº API è¯·æ±‚å¹¶ä¸å†ç»è¿‡ä¼ ç»Ÿå°è£…çš„ ViewSetï¼ŒåŸæœ‰çš„é‰´æƒç»„ä»¶ä¸å†èƒ½ä½¿ç”¨ï¼Œä½ éœ€è¦å¼•å…¥æ–°çš„ <a target="_blank" rel="noopener" href="https://github.com/redzej/graphene-permissions">graphene-permissions</a> æ¥è§£å†³é’ˆå¯¹ç”¨æˆ·çš„æƒé™æ§åˆ¶ã€‚</p>
<p>æœ¬æ–‡æˆæ–‡æ—¶ï¼Œgraphene-permissions å¯¹äºæœ€æ–°çš„ Graphene 3.x æœ‰ä¸€äº›<a target="_blank" rel="noopener" href="https://github.com/redzej/graphene-permissions/pull/36">å°çš„å…¼å®¹æ€§é—®é¢˜</a>ï¼Œç”±äºè¯¥åº“ä»£ç é‡éå¸¸å°ï¼Œå¯ä»¥è€ƒè™‘å¤åˆ¶åˆ°è‡ªå·±çš„é¡¹ç›®æ‰‹åŠ¨ç»´æŠ¤ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .mixins <span class="keyword">import</span> AuthNode</span><br><span class="line"><span class="keyword">from</span> .permissions <span class="keyword">import</span> AllowSuperuser</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserNode</span>(AuthNode, DjangoObjectType):</span><br><span class="line">    permission_classes = (AllowAuthenticated,)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = User</span><br><span class="line">        filter_fields = (<span class="string">&#x27;username&#x27;</span>,)</span><br><span class="line">        interfaces = (relay.Node,)</span><br></pre></td></tr></table></figure>

<p>å°´å°¬çš„æ˜¯ï¼Œå¦‚æœä½ å¹¶ä¸æƒ³ç”¨ Relayï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹ graphene-django-extras åšä¸€äº›è‡ªå·±çš„å®šåˆ¶ï¼Œè€ŒåŸæœ‰çš„å°è£…æ²¡æœ‰å¾ˆå¥½åœ°æš´éœ²è¶³å¤Ÿçš„æ¥å£ï¼Œç»è¿‡ä¸€ç•ªæ¢ç´¢å¹¶æ— å¤´ç»ªï¼Œæœ€ç»ˆä½œç½¢ğŸ¥´ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>GraphQL åœ¨å‰ç«¯éœ€æ±‚è¿­ä»£é¢‘ç¹çš„åœºæ™¯ä¸‹ï¼Œæ¯” REST æ›´ç¬¦åˆç°ä»£å¼€å‘èŠ‚å¥</li>
<li>GraphQL çš„è¯­è¨€è®¾è®¡æ¯”è‡ªå®šä¹‰æ‰©å±•çš„ REST æ›´è‡ªç„¶ï¼Œæ›´å…·å¤‡é€šç”¨æ€§</li>
<li>GraphQL ä¼šå°†æ¯”è¾ƒå¤šçš„å·¥ä½œæ”¾åˆ°å®¢æˆ·ç«¯ï¼Œé€‚åˆæˆç†Ÿçš„å®¢æˆ·ç«¯å¼€å‘å›¢é˜Ÿï¼Œåä¹‹ REST æ˜¯æ›´å¥½çš„é€‰æ‹©</li>
<li>Django ç›¸å…³çš„ç”Ÿæ€å»ºè®¾å¹¶ä¸å®Œå–„ï¼Œæ²¡æœ‰ä¸€ä¸ªè¶³å¤Ÿå¼ºå¤§ã€å¼€ç®±å³ç”¨çš„æ•´åˆæ–¹æ¡ˆ</li>
<li>ç”±äºæŸ¥è¯¢å¹¶ä¸æ˜¯åŸºäº Uri ç»´åº¦ï¼Œä¼šç»™å‘¨è¾¹é…å¥—çš„ç”Ÿæ€â€”â€” ç›‘æ§ã€æ—¥å¿—ç­‰ â€”â€”å¸¦æ¥ä¸€äº›æ–°çš„æŒ‘æˆ˜</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Blues Yu</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://emergencyexit.xyz/use-graphql-with-django.html">https://emergencyexit.xyz/use-graphql-with-django.html</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2025 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/python/"># python</a>
                    
                        <a href="/tags/tech/"># tech</a>
                    
                        <a href="/tags/django/"># django</a>
                    
                        <a href="/tags/graphql/"># graphql</a>
                    
                        <a href="/tags/web/"># web</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/use-konajdk-in-logstash-image.html">å°è®°ï¼šå¦‚ä½•å°† Logstash7 é•œåƒæ›¿æ¢ä¸º KonaJDK</a>
            
            
            <a class="next" rel="next" href="/amqp-header-has-frame-max-limit.html">ğŸš¨ ä¸è¦å¾€ AMQP çš„ Header ä¹±å¡ä¸œè¥¿</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© Blues Yu | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>